{
  "prompt": "Goal: Validate the end-to-end pipeline with a small deterministic tier.\nBudget tokens: 800\nModel context window token limit: 16384\nYou are a dungeon defender strategist.\nConfigure defender actors and affinity stacks only.\nThe level layout is already planned and must not be changed.\nChoose only from the allowed lists; do not invent new affinities, expressions, or motivations.\nAffinities: fire, water, earth, wind, life, decay, corrode, dark\nAffinity expressions: push, pull, emit\nMotivations: random, stationary, exploring, attacking, defending, patrolling, reflexive, goal_oriented, strategy_focused\n\nPhase instructions:\n- Phase: actors_only\n- Return defenders only; omit rooms and layout.\n- Include at least one defender entry (count >= 1).\n- Use valid JSON with double quotes only; no trailing commas.\n- Spend as much of the remaining budget as possible while staying feasible.\n\nDefender viability guardrails:\n- If you include affinities or stacks, include vitals with mana > 0 and mana regen > 0.\n- Ensure defenders have non-trivial health (current/max >= 6).\n- Keep affinity stacks modest (1-3) unless mana and regen are higher.\n- You may include per-actor vitals: health/mana/stamina/durability each with current/max/regen.\n\nResponse shape:\n{ \"phase\": \"actors_only\", \"remainingBudgetTokens\": <int>, \"actors\": [{\"motivation\":<motivation>,\"affinity\":<affinity>,\"count\":<int>,\"tokenHint\":<int?>,\"affinities\":[{\"kind\":<affinity>,\"expression\":<expression>,\"stacks\":<int?>}],\"vitals\":{\"health\":{\"current\":<int>,\"max\":<int>,\"regen\":<int>},\"mana\":{\"current\":<int>,\"max\":<int>,\"regen\":<int>},\"stamina\":{\"current\":<int>,\"max\":<int>,\"regen\":<int>},\"durability\":{\"current\":<int>,\"max\":<int>,\"regen\":<int>}}}], \"missing\": [], \"stop\": \"done\" | \"missing\" | \"no_viable_spend\" }\n\nFinal request: return the JSON now. Output JSON only (no markdown, no commentary).",
  "responseRaw": "{\"dungeonAffinity\":\"fire\",\"budgetTokens\":800,\"rooms\":[{\"motivation\":\"stationary\",\"affinity\":\"fire\",\"count\":1,\"tokenHint\":200,\"affinities\":[{\"kind\":\"fire\",\"expression\":\"push\",\"stacks\":1}]}],\"actors\":[{\"motivation\":\"attacking\",\"affinity\":\"fire\",\"count\":1,\"tokenHint\":200,\"affinities\":[{\"kind\":\"fire\",\"expression\":\"push\",\"stacks\":2}]}],\"missing\":[]}",
  "responseParsed": {
    "dungeonAffinity": "fire",
    "budgetTokens": 800,
    "rooms": [
      {
        "motivation": "stationary",
        "affinity": "fire",
        "count": 1,
        "tokenHint": 200,
        "affinities": [
          {
            "kind": "fire",
            "expression": "push",
            "stacks": 1
          }
        ]
      }
    ],
    "actors": [
      {
        "motivation": "attacking",
        "affinity": "fire",
        "count": 1,
        "tokenHint": 200,
        "affinities": [
          {
            "kind": "fire",
            "expression": "push",
            "stacks": 2
          }
        ]
      }
    ],
    "missing": []
  }
}
